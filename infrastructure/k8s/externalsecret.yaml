# infrastructure/k8s/externalsecret.yaml
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: orbit-secrets
  namespace: orbit
spec:
  refreshInterval: "1h"
  secretStoreRef:
    kind: ClusterSecretStore
    name: doppler-cluster-secret-store
  target:
    name: orbit-secrets
  data:
    # MongoDB
    - secretKey: MONGO_ROOT_USERNAME
      remoteRef: { key: ORBIT_MONGO_ROOT_USERNAME }
    - secretKey: MONGO_ROOT_PASSWORD
      remoteRef: { key: ORBIT_MONGO_ROOT_PASSWORD }
    # PostgreSQL
    - secretKey: POSTGRES_USER
      remoteRef: { key: ORBIT_POSTGRES_USER }
    - secretKey: POSTGRES_PASSWORD
      remoteRef: { key: ORBIT_POSTGRES_PASSWORD }
    # MinIO
    - secretKey: MINIO_ROOT_USER
      remoteRef: { key: ORBIT_MINIO_ROOT_USER }
    - secretKey: MINIO_ROOT_PASSWORD
      remoteRef: { key: ORBIT_MINIO_ROOT_PASSWORD }
    # orbit-www application secrets
    - secretKey: PAYLOAD_SECRET
      remoteRef: { key: ORBIT_PAYLOAD_SECRET }
    - secretKey: ENCRYPTION_KEY
      remoteRef: { key: ORBIT_ENCRYPTION_KEY }
    - secretKey: BETTER_AUTH_SECRET
      remoteRef: { key: ORBIT_BETTER_AUTH_SECRET }
    - secretKey: RESEND_API_KEY
      remoteRef: { key: ORBIT_RESEND_API_KEY }
    - secretKey: RESEND_FROM_EMAIL
      remoteRef: { key: ORBIT_RESEND_FROM_EMAIL }
    # GitHub App
    - secretKey: GITHUB_APP_ID
      remoteRef: { key: ORBIT_GITHUB_APP_ID }
    - secretKey: GITHUB_CLIENT_ID
      remoteRef: { key: ORBIT_GITHUB_CLIENT_ID }
    - secretKey: GITHUB_CLIENT_SECRET
      remoteRef: { key: ORBIT_GITHUB_CLIENT_SECRET }
    - secretKey: GITHUB_WEBHOOK_SECRET
      remoteRef: { key: ORBIT_GITHUB_WEBHOOK_SECRET }
    # Inter-service auth
    - secretKey: ORBIT_INTERNAL_API_KEY
      remoteRef: { key: ORBIT_INTERNAL_API_KEY }
    - secretKey: JWT_SECRET
      remoteRef: { key: ORBIT_JWT_SECRET }
    # Registry
    - secretKey: ORBIT_REGISTRY_PASSWORD
      remoteRef: { key: ORBIT_REGISTRY_PASSWORD }
    - secretKey: ORBIT_REGISTRY_JWT_SECRET
      remoteRef: { key: ORBIT_REGISTRY_JWT_SECRET }
